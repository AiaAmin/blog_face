@model IEnumerable<Dal.models.City>
<p>
    <a asp-action="Create">Create New</a>
</p>
<hr/>
<h1 id="tesst"> </h1>
@* @Html.Partial("_partTime")
@Html.Partial("_cityCreate") *@

<div class="row">
    <div class="col-md-4">

        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <div class="form-group">
            <label for="Name">City</label>
            <input class="form-control" type="text" id="city-name" value="">
        </div>
        <div class="form-group">
            <button id="create-city">Create</button>
            @* <input type="submit" value="Create" class="btn btn-primary" id="Testj"/> *@
        </div>

    </div>
</div>
<hr/>
<div id="PartCity">
    <table>
        <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Id)
            </th>

            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th></th>
        </tr>
        </thead>
        <tbody class="table">
        @foreach (var item in Model)
        {
            <tr class="tROW">
                <td>
                    @Html.DisplayFor(modelItem => item.Id)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Name, new {@class = "ussername"}))
                </td>
                <td>
                @Html.ActionLink("Edit", "Edit", new {id = item.Id}) |
                @Html.ActionLink("Details", "Details", new {id = item.Id}) |
                @Html.ActionLink("Delete", "Delete", new {id = item.Id})
                <button class="delete-city btn btn-danger" data-city-id="@item.Id">Delete</button>
                <td>
                </td>
            </tr>
        }
        </tbody>
    </table>

</div>

<script type="text/javascript">
$(function(){
    $("#create-city").click(function(){
            var cityName=$("#city-name").val();
            $.post("/city/Create",{name:cityName},function(data,status){
                console.log(status);
                console.log(data);
                console.log(data.id);
                $(".table").append("<tr><td>"+
                        data.id+
                    "</td><td>"+data.name+
                    "</td><td>"+
                        '<td><a href="/City/Edit/'+data.id+
                        '">Edit</a> |<a href="/City/Details/'+data.id+
                        '">Details</a> |<a href="/City/Delete/'+
                        data.id+'">Delete</a></td>'
                    +"</td></tr>");

  });
            });     
    $(".delete-city").click(function(e){
        var r=confirm("Are you sure you want to delete this item");
            if(r==true){
                console.log("in deelllllll");
                console.log(e.currentTarget);
                
                var cityId=$(e.currentTarget).attr("data-city-id");
                console.log(cityId);
                // todo: send delete ajax call
                 @* $.post("/city/DeleteCity",{id:cityId},function(data,status){
                     console.log(data);
                     console.log(data.id);
                     console.log(status); *@
                     /*DELETE*/
                    $.ajax({
                        url: '/city/DeleteCity',
                        dataType: "json",
                        type: "DELETE",
                        data: JSON.stringify({id: cityId}),
                        async: true,
                        processData: false,
                        cache: false,
                        success: function (data) {
                            alert(data);
                        },
                        error: function (xhr) {
                            alert('error');
                        }
                   
                    //-------------------------------------------------------
                });
                // rempve row
                $(e.currentTarget).parent().parent().remove();

            }
});
});
</script>